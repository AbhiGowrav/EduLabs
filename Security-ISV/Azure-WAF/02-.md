# Adding Backend Targets

## Overview

In this task, you will create two virtual machines with IIS installed in it. This virtual machines will be using as a backend servers for the application gateway.

1. On the **+create a resource**, on the search bar type **Virtual machine** and click on **Create**.

1. On the create a virtual machine, provide the following details : 

     * Subscription : **Choose your subscription**

     * Resource group : **waf-[deploymentID]** (use existing)

     * Virtual machine name : **client1DID**

     * Availabilty Options : **No infrastructure redundancy required**

     * Image : **Windows Server 2019 Datacenter - Gen2**

     * Size :  **Standard_D2s_v3**

     * Username : **azureuser1**

     * Password : **Password.!!1**

     * Public Inbound Ports : **None**

1. Accept the other defaults and then select **Next: Disks**.

1. On the disks page, provide the following details

      * OS Disk type : **Standard HDD**

1. Accept all the default, and click on **Networking**.

1. On the Networking page, provide the details : 
  
     * Virtual Network : **vnetDID** (use existing which was created earlier)

     * Subnet : **MyBackendsubnet**

     * PublicIP : **None**

1. Leave other settings as default and click on **Next : Management**.

1. On the management page, under **Boot diagnostics** select **Disable**.

1. For **Enable auto-shutdown** unselect the checkbox.

1. Leave all others as default, select **Next: Advanced**.

1. Review and select **Next : Tags**.

1. On the tags page, select **Next : Review+create**.

1. Click on **Create**.

    >Note : Wait for the virtual machine creation to complete before continuing.

1. Create a second virtual machine by using the steps that you previously completed and change the following settings that is mentioned below and click on **Review+create**.

     * Virtual machine name : **client2DID**
     
     * Username : **azureuser1**

     * Password : **Password.!!1**

1. Wait unit the virtual machine creation to complete before continuing.

1. On the top right of the azure portal, click on **Cloud Shell**.

1. On the page displaying **you have no mounted storage**, click on **Advanced Settings**.

1. When prompted, in the show **advanced settings** page, select Use existing and choose **existing resource group**. Then select Create new against Storage account as well as File Share and provide a unique value in both of the fields and then click on Create storage, and wait for the Azure Cloud Shell to initialize.

1. When prompted to select either **Bash** or **PowerShell**, select **PowerShell**.  

1. Set the location parameter according to the resource group, and then run the following command to install IIS on the virtual machine

     ``````
     Set-AzVMExtension `
    -ResourceGroupName myResourceGroupAG `
    -ExtensionName IIS `
    -VMName client1DID `
    -Publisher Microsoft.Compute `
    -ExtensionType CustomScriptExtension `
    -TypeHandlerVersion 1.4 `
    -SettingString '{"commandToExecute":"powershell Add-WindowsFeature Web-Server; powershell Add-Content -Path \"C:\\inetpub\\wwwroot\\Default.htm\" -Value $($env:computername)"}' `
    -Location EastUS
    ``````
    
1. Repeat the same step to install IIS for the second virtual machine and verify the status code as **OK**.


